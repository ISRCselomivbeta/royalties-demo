<div id="lista-musicas">Carregando mercado musical...</div>

<script>
// Configura√ß√µes iniciais
const PLAYLIST_ID = 'PLvteL0_9cu8oE_N4Qfz5JJucTTkY2czcN';
const API_KEY = 'SUA_CHAVE_DO_GOOGLE_AQUI'; // Voc√™ precisar√° de uma chave da API do YouTube

async function carregarPlaylist() {
    try {
        // Busca os v√≠deos da playlist no YouTube
        const response = await fetch(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${PLAYLIST_ID}&key=${API_KEY}`);
        const data = await response.json();
        
        const container = document.getElementById('lista-musicas');
        container.innerHTML = ''; // Limpa o texto de carregando

        data.items.forEach(item => {
            const titulo = item.snippet.title;
            const videoId = item.snippet.resourceId.videoId;
            const thumb = item.snippet.thumbnails.medium.url;

            // Cria o card para cada m√∫sica da playlist
            container.innerHTML += `
                <div class="card bg-dark text-white p-3 mb-3 border-secondary">
                    <div class="row align-items-center">
                        <div class="col-md-4">
                            <iframe width="100%" height="150" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="col-md-8">
                            <h5>M√∫sica: ${titulo}</h5>
                            <p>Pre√ßo do Ativo: <span class="text-success">R$ 15,00</span></p>
                            
                            <div class="input-group mb-3">
                                <input type="number" id="qtd_${videoId}" class="form-control" placeholder="Qtd">
                                <button class="btn btn-success" onclick="negociar('COMPRA', '${videoId}', '${titulo}')">Comprar</button>
                                <button class="btn btn-danger" onclick="negociar('VENDA', '${videoId}', '${titulo}')">Vender</button>
                            </div>

                            <div class="d-flex gap-2">
                                <button class="btn btn-sm btn-outline-primary">‚ù§Ô∏è Curtir</button>
                                <button class="btn btn-sm btn-outline-info">üîó Compartilhar</button>
                                <small class="text-warning ml-auto">Ouvir √© Ganhar: +R$ 0,01 por play</small>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });
    } catch (error) {
        console.error("Erro ao carregar playlist:", error);
        document.getElementById('lista-musicas').innerHTML = "Erro ao carregar m√∫sicas. Verifique a chave da API.";
    }
}

async function negociar(tipo, idMusica, nomeMusica) {
    const qtd = document.getElementById('qtd_' + idMusica).value;
    
    if(!qtd || qtd <= 0) {
        alert("Por favor, insira uma quantidade.");
        return;
    }

    // Aqui ele envia para o seu servidor
    const res = await fetch(API_URL, {
        method: 'POST',
        body: new URLSearchParams({
            acao: 'negociar_acao',
            user_id: localStorage.getItem('userId'),
            musica_id: idMusica,
            nome_musica: nomeMusica,
            quantidade: qtd,
            preco_unitario: 15.00,
            tipo_ordem: tipo
        })
    });
    
    alert(`${tipo} de ${qtd} fra√ß√£o(√µes) da m√∫sica "${nomeMusica}" realizada com sucesso!`);
}

// Inicia a busca assim que a p√°gina abre
carregarPlaylist();
</script>
