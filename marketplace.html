<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Music Marketplace</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #000; color: white; }
        .card-musica { background-color: #121212; border: 1px solid #333; transition: 0.3s; }
        .card-musica:hover { border-color: #1db954; }
        .btn-success { background-color: #1db954; border: none; }
        .carteira { background: #1db954; color: black; border-radius: 10px; padding: 15px; margin-bottom: 30px; }
    </style>
</head>
<body>

<div class="container py-4">
    <div class="carteira d-flex justify-content-between align-items-center shadow">
        <div>
            <h4 class="mb-0">Minha Carteira Musical</h4>
            <small>Simula√ß√£o de Investimento</small>
        </div>
        <div class="text-end">
            <h3 id="meu-saldo">R$ 1.000,00</h3>
            <small id="minhas-acoes">0 a√ß√µes adquiridas</small>
        </div>
    </div>

    <h2 class="mb-4">üìà Mercado de Ativos (Playlist)</h2>
    
    <div id="mercado-container" class="row">
        <div class="text-center">Sincronizando com o YouTube...</div>
    </div>
</div>

<script>
// CONFIGURA√á√ïES
const API_KEY = 'AIzaSyAPaYGY_MrrNgKdEqTs3Qw7tPNv5p5QwPM';
const PLAYLIST_ID = 'PLvteL0_9cu8oE_N4Qfz5JJucTTkY2czcN';

// Vari√°veis de controle (Simulando o Banco de Dados no Navegador)
let saldo = 1000.00;
let acoesPossuidas = 0;

async function carregarPlaylist() {
    try {
        const response = await fetch(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${PLAYLIST_ID}&key=${API_KEY}`);
        const data = await response.json();
        
        const container = document.getElementById('mercado-container');
        container.innerHTML = ''; 

        data.items.forEach(item => {
            const titulo = item.snippet.title;
            const videoId = item.snippet.resourceId.videoId;

            container.innerHTML += `
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card card-musica h-100 p-3 text-white">
                        <iframe width="100%" height="180" src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen class="rounded mb-3"></iframe>
                        <h6 class="text-truncate">${titulo}</h6>
                        <p class="text-success mb-2">Cota: <strong>R$ 15,00</strong></p>
                        
                        <div class="input-group mb-2">
                            <input type="number" id="qtd_${videoId}" class="form-control form-control-sm bg-dark text-white border-secondary" placeholder="Qtd">
                            <button class="btn btn-sm btn-success" onclick="negociar('COMPRA', '${videoId}', 15, '${titulo}')">Comprar</button>
                        </div>
                        
                        <div class="d-flex justify-content-between mt-2">
                            <button class="btn btn-sm btn-outline-light" onclick="alert('Compartilhado!')">üîó</button>
                            <button class="btn btn-sm btn-outline-danger" onclick="negociar('VENDA', '${videoId}', 15, '${titulo}')">Vender</button>
                            <small class="text-warning">üéÅ +R$ 0,01 play</small>
                        </div>
                    </div>
                </div>`;
        });
    } catch (e) {
        document.getElementById('mercado-container').innerHTML = "Erro ao carregar m√∫sicas. Verifique sua chave API.";
    }
}

function negociar(tipo, id, preco, nome) {
    const input = document.getElementById('qtd_' + id);
    const qtd = parseInt(input.value);

    if (!qtd || qtd <= 0) {
        alert("Digite uma quantidade v√°lida.");
        return;
    }

    const custoTotal = qtd * preco;

    if (tipo === 'COMPRA') {
        if (saldo >= custoTotal) {
            saldo -= custoTotal;
            acoesPossuidas += qtd;
            alert(`Sucesso! Voc√™ comprou ${qtd} cotas de: ${nome}`);
        } else {
            alert("Saldo insuficiente!");
        }
    } else {
        if (acoesPossuidas >= qtd) {
            saldo += custoTotal;
            acoesPossuidas -= qtd;
            alert(`Venda realizada: ${qtd} cotas de: ${nome}`);
        } else {
            alert("Voc√™ n√£o tem cotas suficientes para vender.");
        }
    }

    // Atualiza a tela
    document.getElementById('meu-saldo').innerText = `R$ ${saldo.toFixed(2)}`;
    document.getElementById('minhas-acoes').innerText = `${acoesPossuidas} a√ß√µes adquiridas`;
    input.value = '';
}

// Inicia tudo
carregarPlaylist();
</script>

</body>
</html>
