<div id="mercado-musical" class="container mt-4">
    <div class="text-center text-white" id="status">
        <div class="spinner-border text-success" role="status"></div>
        <p>Sincronizando com a Playlist...</p>
    </div>
</div>

<script>
// Suas configura√ß√µes
const API_KEY = 'AIzaSyAPaYGY_MrrNgKdEqTs3Qw7tPNv5p5QwPM';
const PLAYLIST_ID = 'PLvteL0_9cu8oE_N4Qfz5JJucTTkY2czcN';
const API_URL = 'SUA_URL_DE_BACKEND_AQUI'; // Onde os dados da compra s√£o salvos

async function carregarPlaylist() {
    try {
        const response = await fetch(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${PLAYLIST_ID}&key=${API_KEY}`);
        const data = await response.json();
        
        const container = document.getElementById('mercado-musical');
        container.innerHTML = ''; // Limpa o carregando

        data.items.forEach(item => {
            const titulo = item.snippet.title;
            const videoId = item.snippet.resourceId.videoId;
            const linkYoutube = `https://www.youtube.com/watch?v=${videoId}`;

            container.innerHTML += `
                <div class="card bg-dark text-white p-3 mb-4 border-secondary shadow shadow-sm">
                    <div class="row">
                        <div class="col-md-5">
                            <div class="ratio ratio-16x9">
                                <iframe src="https://www.youtube.com/embed/${videoId}?enablejsapi=1" 
                                        title="${titulo}" frameborder="0" 
                                        allow="autoplay; encrypted-media" allowfullscreen></iframe>
                            </div>
                        </div>

                        <div class="col-md-7">
                            <h5 class="text-truncate">${titulo}</h5>
                            <p class="mb-2">A√ß√£o: <span class="text-success fw-bold">R$ 15,00</span></p>
                            
                            <div class="input-group mb-3">
                                <input type="number" id="qtd_${videoId}" class="form-control" placeholder="Quantas partes?">
                                <button class="btn btn-success" onclick="negociar('COMPRA', '${videoId}', '${titulo}')">Comprar</button>
                                <button class="btn btn-danger" onclick="negociar('VENDA', '${videoId}', '${titulo}')">Vender</button>
                            </div>

                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <button class="btn btn-outline-light btn-sm" onclick="alert('M√∫sica curtida!')">‚ù§Ô∏è</button>
                                    <button class="btn btn-outline-light btn-sm" onclick="window.open('${linkYoutube}', '_blank')">üîó Compartilhar</button>
                                </div>
                                <span class="badge bg-warning text-dark">üéÅ Play = R$ 0,01</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });
    } catch (error) {
        document.getElementById('mercado-musical').innerHTML = `<div class="alert alert-danger">Erro ao conectar: ${error}</div>`;
    }
}

async function negociar(tipo, id, nome) {
    const qtd = document.getElementById('qtd_' + id).value;
    if (!qtd || qtd <= 0) return alert("Digite uma quantidade v√°lida");

    // L√≥gica de envio para o seu servidor
    console.log(`Enviando ordem de ${tipo}: ${qtd} de ${nome}`);
    
    // Simula√ß√£o de resposta do servidor
    alert(`Sucesso! Voc√™ acaba de ${tipo === 'COMPRA' ? 'adquirir' : 'vender'} ${qtd} fra√ß√µes de "${nome}".`);
}

// Inicializa o Marketplace
carregarPlaylist();
</script>
