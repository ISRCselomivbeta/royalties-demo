<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Investidor | SELO MIV</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<style>
:root {
    --success: #28a745;
    --dark: #0f2027;
}
body {
    background:#f5f6f7;
}
.navbar-investor {
    background: linear-gradient(135deg, #1a3a1a, #2d5a2d);
}
.card-soft {
    border-radius: 16px;
    box-shadow: 0 5px 18px rgba(0,0,0,.05);
}
.btn-invest {
    background: linear-gradient(135deg, #28a745, #20c997);
    color:#fff;
    border:none;
    border-radius:10px;
}
</style>
</head>

<body>

<!-- üîê PROTE√á√ÉO DE ROTA -->
<script>
if (localStorage.getItem("userType") !== "investidor") {
    alert("Acesso restrito. Fa√ßa login como investidor.");
    window.location.href = "login.html";
}
</script>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark navbar-investor">
<div class="container-fluid">
    <span class="navbar-brand fw-bold">
        SELO <span style="color:#90ee90">MIV</span>
        <small class="d-block" style="font-size:10px">INVESTIDOR</small>
    </span>

    <div class="dropdown">
        <button class="btn btn-outline-light dropdown-toggle" data-bs-toggle="dropdown">
            <i class="bi bi-person-circle me-2"></i>
            <span id="nomeInvestidor">Investidor</span>
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item text-danger" href="#" onclick="logout()">Sair</a></li>
        </ul>
    </div>
</div>
</nav>

<div class="container mt-4">

<!-- RESUMO -->
<div class="row g-3 mb-4">
    <div class="col-md-4">
        <div class="card card-soft p-3">
            <small class="text-muted">Total Investido</small>
            <h4 id="totalInvestido">R$ 0,00</h4>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card card-soft p-3">
            <small class="text-muted">Royalties Recebidos</small>
            <h4 id="totalRoyalties">R$ 0,00</h4>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card card-soft p-3">
            <small class="text-muted">Artistas Investidos</small>
            <h4 id="totalArtistas">0</h4>
        </div>
    </div>
</div>

<!-- OPORTUNIDADES -->
<div class="card card-soft mb-4">
<div class="card-body">
<h5 class="mb-3">üéµ Oportunidades de Investimento</h5>

<div class="row" id="listaArtistas">
    <div class="text-center text-muted py-4">
        <div class="spinner-border"></div>
        <p class="mt-2">Carregando artistas...</p>
    </div>
</div>
</div>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbztk1ciaAYousnQgD3oTAtgVtiilhbiG25WcmP85QZatociltDhbc_wOnkeFrTwKoY/exec";

/* =============================
   DADOS DO USU√ÅRIO
============================= */
const investidorNome = localStorage.getItem("userId") || "Investidor";
document.getElementById("nomeInvestidor").innerText = investidorNome;

/* =============================
   LOGOUT
============================= */
function logout(){
    localStorage.clear();
    window.location.href = "index.html";
}

/* =============================
   CARREGAR ARTISTAS
============================= */
async function carregarArtistas(){
    try{
        const res = await fetch(API_URL,{
            method:"POST",
            headers:{ "Content-Type":"application/json" },
            body: JSON.stringify({ acao:"listar_artistas" })
        });

        const data = await res.json();
        const container = document.getElementById("listaArtistas");

        if(!data.success || !data.artistas?.length){
            container.innerHTML = "<p class='text-muted'>Nenhum artista dispon√≠vel.</p>";
            return;
        }

        container.innerHTML = "";
        data.artistas.forEach(a=>{
            container.innerHTML += `
            <div class="col-md-4 mb-3">
                <div class="card card-soft p-3 h-100">
                    <h6 class="fw-bold">${a.nome}</h6>
                    <small class="text-muted">${a.email}</small>
                    <hr>
                    <button class="btn btn-invest w-100"
                        onclick="investir('${a.id}','${a.nome}')">
                        Investir
                    </button>
                </div>
            </div>`;
        });

    }catch(e){
        document.getElementById("listaArtistas").innerHTML =
            "<p class='text-danger'>Erro ao conectar com a API.</p>";
    }
}

/* =============================
   INVESTIR
============================= */
function investir(id,nome){
    const valor = prompt(`Valor para investir em ${nome}:`,"5000");
    if(!valor || isNaN(valor)) return;

    alert(`‚úÖ Investimento registrado!\nArtista: ${nome}\nValor: R$ ${Number(valor).toLocaleString("pt-BR")}`);
}

/* =============================
   INIT
============================= */
document.addEventListener("DOMContentLoaded", carregarArtistas);
</script>

</body>
</html>
