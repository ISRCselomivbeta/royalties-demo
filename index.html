<section id="login-screen" style="height: 100vh; display: flex; align-items: center; justify-content: center; background: #07090c;">
    <div style="background: #111418; padding: 40px; border-radius: 20px; border: 1px solid #1e2329; width: 100%; max-width: 400px;" class="text-center">
        <h2 class="fw-bold mb-4" style="color: #00ff88;">MIV <span style="color: white;">PRO</span></h2>
        <p class="text-secondary small mb-4">Acesse sua carteira de ativos musicais</p>
        
        <div class="mb-3 text-start">
            <label class="small text-secondary">E-mail ou Usuário</label>
            <input type="text" id="user-email" class="form-control bg-dark text-white border-secondary" placeholder="exemplo@miv.com">
        </div>
        
        <div class="mb-4 text-start">
            <label class="small text-secondary">Senha</label>
            <input type="password" id="user-pass" class="form-control bg-dark text-white border-secondary" placeholder="••••••••">
        </div>
        
        <button class="btn w-100 fw-bold" style="background: #00ff88; color: #000; padding: 12px; border-radius: 10px;" onclick="fazerLogin()">
            ENTRAR NO SISTEMA
        </button>
        
        <div id="login-error" class="text-danger mt-3 small" style="display: none;">Usuário ou senha inválidos.</div>
    </div>
</section>

<div id="main-app" style="display: none;">
    <div class="container py-3">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h5 class="mb-0">Olá, <span id="user-name" class="text-success">...</span></h5>
            <button class="btn btn-sm btn-outline-danger" onclick="logout()">Sair</button>
        </div>
        
        <div class="card bg-dark border-secondary p-3 mb-4">
            <small class="text-secondary">SALDO EM CONTA</small>
            <h2 id="user-balance" class="fw-bold mb-0">R$ 0,00</h2>
        </div>
        
        </div>
</div>

<script>
    // URL DA SUA IMPLANTAÇÃO
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbyQ1UtXofZc8TGNU7WFhWmHWmJI7yZuv8cOTTTouMdJUheS7IX45rL2nKmgBbiaZ0Gr/exec';

    async function fazerLogin() {
        const usuario = document.getElementById('user-email').value;
        const senha = document.getElementById('user-pass').value;
        const errorDiv = document.getElementById('login-error');

        if (!usuario || !senha) {
            alert("Por favor, preencha todos os campos.");
            return;
        }

        // Feedback visual de carregamento
        document.querySelector('button').innerText = "AUTENTICANDO...";
        errorDiv.style.display = 'none';

        try {
            // Chamada para o Google Apps Script
            const response = await fetch(`${WEB_APP_URL}?acao=login&usuario=${usuario}&senha=${senha}`);
            const data = await response.json();

            if (data.success) {
                // SALVAR SESSÃO: Armazena os dados básicos no navegador
                localStorage.setItem('miv_session', JSON.stringify(data));
                abrirApp(data);
            } else {
                errorDiv.style.display = 'block';
                document.querySelector('button').innerText = "ENTRAR NO SISTEMA";
            }
        } catch (error) {
            console.error(error);
            alert("Erro de conexão com o servidor MIV.");
            document.querySelector('button').innerText = "ENTRAR NO SISTEMA";
        }
    }

    function abrirApp(user) {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'block';
        
        // Atualiza os dados na tela com informações da planilha
        document.getElementById('user-name').innerText = user.nome;
        document.getElementById('user-balance').innerText = `R$ ${user.saldo.toFixed(2)}`;
        
        // Inicia a playlist e outras funções que você já tem
        if(typeof carregarPlaylist === "function") carregarPlaylist();
    }

    function logout() {
        localStorage.removeItem('miv_session');
        location.reload();
    }

    // VERIFICAÇÃO AUTOMÁTICA AO CARREGAR A PÁGINA
    window.onload = () => {
        const sessaoAtiva = localStorage.getItem('miv_session');
        if (sessaoAtiva) {
            abrirApp(JSON.parse(sessaoAtiva));
        }
    }
</script>
