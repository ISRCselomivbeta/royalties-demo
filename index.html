<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Selo MIV - Plataforma de Investimento em MÃºsica</title>
<style>
/* ====== SEU CSS ORIGINAL â€“ SEM ALTERAÃ‡Ã•ES ====== */
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Arial,sans-serif}
body{background:linear-gradient(135deg,#0a192f 0%,#1a1a2e 100%);color:#fff;min-height:100vh}
.container{max-width:1200px;margin:0 auto;padding:20px}
/* toast */
.toast{position:fixed;top:20px;right:20px;padding:15px 20px;border-radius:8px;color:#fff;z-index:1000}
.toast.success{background:#10b981}
.toast.error{background:#ef4444}
.toast.info{background:#3b82f6}
/* loading */
.loading-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);display:flex;justify-content:center;align-items:center;z-index:9999;flex-direction:column}
.spinner{width:50px;height:50px;border:5px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#00ff88;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<div id="loadingOverlay" class="loading-overlay" style="display:none">
  <div class="spinner"></div>
  <p id="loadingMessage"></p>
</div>

<div id="toastContainer"></div>

<div class="container">

<div id="loginSection">
  <h2>Login</h2>
  <input id="loginEmail" placeholder="email">
  <input id="loginPassword" type="password" placeholder="senha">
  <button onclick="handleLogin()">Entrar</button>
</div>

<div id="registerSection" style="display:none">
  <h2>Cadastro</h2>
  <input id="registerName" placeholder="nome">
  <input id="registerEmail" placeholder="email">
  <input id="registerPassword" type="password" placeholder="senha">
  <select id="registerType">
    <option value="">Selecione</option>
    <option value="ouvinte">Ouvinte</option>
    <option value="artista">Artista</option>
    <option value="admin">Admin</option>
  </select>
  <input id="registerLink" placeholder="link trabalho">
  <button onclick="handleRegister()">Cadastrar</button>
</div>

</div>

<script>
const CONFIG = {
  API_URL: "https://script.google.com/macros/s/AKfycbyY_OpX7qp_sGowaAJHN21z7jx5_E2sIhIKhOvEw7NUBKYi72mDuXFMC2qif2Cs1HR_/exec"
};

const state = {
  currentUser:null,
  currentToken:null
};

function showToast(msg,type='info'){
  const t=document.createElement('div');
  t.className='toast '+type;
  t.innerText=msg;
  document.getElementById('toastContainer').appendChild(t);
  setTimeout(()=>t.remove(),4000);
}

function showLoading(msg){
  document.getElementById('loadingOverlay').style.display='flex';
  document.getElementById('loadingMessage').innerText=msg;
}
function hideLoading(){
  document.getElementById('loadingOverlay').style.display='none';
}

/* =========================
   LOGIN (CORRIGIDO)
========================= */
async function handleLogin(){
  const email=document.getElementById('loginEmail').value.trim().toLowerCase();
  const password=document.getElementById('loginPassword').value.trim();

  if(!email||!password){
    showToast('Preencha todos os campos','error');
    return;
  }

  showLoading('Autenticando...');

  try{
    const formData=new URLSearchParams();
    formData.append('acao','login');
    formData.append('email',email);
    formData.append('senha',password); // ðŸ”´ CORREÃ‡ÃƒO AQUI

    const res=await fetch(CONFIG.API_URL,{
      method:'POST',
      headers:{'Content-Type':'application/x-www-form-urlencoded'},
      body:formData
    });

    const data=await res.json();

    if(data.success){
      state.currentUser=data.data;
      state.currentToken=data.data.token || data.data.id;
      localStorage.setItem('miv_user',JSON.stringify(state.currentUser));
      localStorage.setItem('miv_token',state.currentToken);
      showToast('Login realizado','success');
    }else{
      showToast(data.message||'Login invÃ¡lido','error');
    }
  }catch(e){
    console.error(e);
    showToast('Erro de conexÃ£o','error');
  }finally{
    hideLoading();
  }
}

/* =========================
   CADASTRO (CORRIGIDO)
========================= */
async function handleRegister(){
  const name=document.getElementById('registerName').value.trim();
  const email=document.getElementById('registerEmail').value.trim().toLowerCase();
  const password=document.getElementById('registerPassword').value.trim();
  const type=document.getElementById('registerType').value;
  const link=document.getElementById('registerLink').value.trim();

  if(!name||!email||!password||!type){
    showToast('Campos obrigatÃ³rios','error');
    return;
  }

  showLoading('Criando conta...');

  try{
    const formData=new URLSearchParams();
    formData.append('acao','register');
    formData.append('nome',name);
    formData.append('email',email);
    formData.append('senha',password); // ðŸ”´ CORREÃ‡ÃƒO AQUI
    formData.append('tipo',type);
    formData.append('workLink',link);

    const res=await fetch(CONFIG.API_URL,{
      method:'POST',
      headers:{'Content-Type':'application/x-www-form-urlencoded'},
      body:formData
    });

    const data=await res.json();

    if(data.success){
      showToast('Cadastro criado','success');
    }else{
      showToast(data.message||'Erro no cadastro','error');
    }
  }catch(e){
    console.error(e);
    showToast('Erro de conexÃ£o','error');
  }finally{
    hideLoading();
  }
}
</script>

</body>
</html>
