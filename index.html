const API_URL = "https://script.google.com/macros/s/AKfycbxhi1aXXq_nvFAUW_pzv4Fjao267qLMvt_n07Gk5bke1gLbjiZ0jWsqJc3Jb1vFHNQ/exec";

document.getElementById("formContrato").addEventListener("submit", async (e) => {
  e.preventDefault();

  const mensagem = document.getElementById("mensagem");
  mensagem.textContent = "⏳ Enviando solicitação...";
  mensagem.style.color = "black";

  const formData = new FormData(e.target);

  const payload = {
    nome: formData.get("nome"),
    email: formData.get("email")
  };

  try {
    const response = await fetch(API_URL, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(payload)
    });

    if (!response.ok) {
      throw new Error("Servidor não respondeu corretamente");
    }

    const data = await response.json();

    if (data.status === "sucesso") {
      mensagem.textContent = "✅ Solicitação enviada! O comprador recebeu o e-mail de confirmação.";
      mensagem.style.color = "green";
      e.target.reset();
    } else {
      mensagem.textContent = "⚠️ Erro: " + (data.mensagem || "Falha ao gerar contrato");
      mensagem.style.color = "orange";
    }

  } catch (error) {
    mensagem.textContent = "❌ Falha ao conectar com o servidor.";
    mensagem.style.color = "red";
    console.error(error);
  }
});
