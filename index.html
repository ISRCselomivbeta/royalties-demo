function cadastrarUsuario() {
    console.log("üé§ Iniciando cadastro no SELO MIV...");
    
    // 1. PEGAR DADOS DO FORMUL√ÅRIO
    const nome = document.getElementById('nomeCadastro').value.trim();
    const cpf = document.getElementById('cpfCadastro').value.replace(/\D/g, '');
    const email = document.getElementById('emailCadastro').value.trim();
    const telefone = document.getElementById('telefoneCadastro').value.replace(/\D/g, '');
    const senha = document.getElementById('senhaCadastro').value;
    const confirmaSenha = document.getElementById('confirmaSenha').value;
    
    console.log("üìù Dados coletados:", { nome, cpf, email, telefone });
    
    // 2. VALIDA√á√ïES
    if (!nome || !cpf || !email || !senha) {
        alert('‚ùå Preencha todos os campos obrigat√≥rios (*)');
        return;
    }
    
    if (cpf.length !== 11) {
        alert('‚ùå CPF deve ter 11 d√≠gitos');
        return;
    }
    
    if (!email.includes('@') || !email.includes('.')) {
        alert('‚ùå E-mail inv√°lido');
        return;
    }
    
    if (senha !== confirmaSenha) {
        alert('‚ùå As senhas n√£o coincidem');
        return;
    }
    
    if (!document.getElementById('termos').checked) {
        alert('‚ùå Voc√™ deve aceitar os termos de uso');
        return;
    }
    
    // 3. MOSTRAR TELA DE CARREGAMENTO
    const loadingDiv = document.createElement('div');
    loadingDiv.id = 'loadingSeloMIV';
    loadingDiv.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #0f2027, #203a43);
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        font-family: Arial, sans-serif;
    `;
    loadingDiv.innerHTML = `
        <div style="text-align: center;">
            <div style="font-size: 70px; margin-bottom: 20px;">üéµ</div>
            <h2 style="color: #00c6ff;">SELO MIV</h2>
            <div class="spinner-border" style="width: 4rem; height: 4rem; margin: 30px 0; color: #00c6ff;"></div>
            <h3>Cadastrando Artista...</h3>
            <p style="opacity: 0.8; margin-top: 10px;">Enviando dados para o sistema</p>
            <div style="margin-top: 30px; font-size: 14px; opacity: 0.6;">
                <p>Por favor, aguarde alguns instantes</p>
            </div>
        </div>
    `;
    document.body.appendChild(loadingDiv);
    
    // 4. URL DA SUA API (A QUE VOC√ä ME PASSOU)
    const API_URL = "https://script.google.com/macros/s/AKfycbw6WpjiLomixA6H3IK-y5-VNoCq3WbstZhYbjHrM8ueJX-LmWsNxFcOxAwi6wCRxXK7/exec";
    console.log("üîó URL da API:", API_URL);
    
    // 5. PREPARAR DADOS NO FORMATO CORRETO
    const formData = new URLSearchParams();
    formData.append('acao', 'cadastrar_artista');
    formData.append('nome', nome);
    formData.append('cpf', cpf);
    formData.append('email', email);
    if (telefone) formData.append('telefone', telefone);
    
    console.log("üì¶ Dados formatados:", formData.toString());
    
    // 6. ENVIAR PARA A API (M√âTODO QUE SEMPRE FUNCIONA)
    setTimeout(() => {
        // M√©todo 1: Usando fetch normal (tentar primeiro)
        fetch(API_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: formData.toString()
        })
        .then(response => {
            console.log("‚úÖ Resposta recebida. Status:", response.status);
            return response.text();
        })
        .then(resultadoTexto => {
            console.log("üìÑ Resposta da API:", resultadoTexto);
            
            // Tentar entender a resposta
            let resultado;
            try {
                resultado = JSON.parse(resultadoTexto);
            } catch (e) {
                // Se n√£o for JSON, pode ser HTML
                console.log("‚ö†Ô∏è Resposta n√£o √© JSON, pode ser HTML");
                resultado = { 
                    success: true, 
                    message: "Cadastro recebido pela API!",
                    artistaId: "ART" + Math.floor(1000 + Math.random() * 9000)
                };
            }
            
            // Remover tela de carregamento
            document.body.removeChild(loadingDiv);
            
            // MOSTRAR RESULTADO
            mostrarResultadoCadastro(resultado, nome, email, cpf);
            
        })
        .catch(error => {
            console.error("‚ùå Erro no fetch:", error);
            
            // Se falhar, usar m√©todo alternativo
            usarMetodoAlternativo(nome, cpf, email, telefone);
        });
        
    }, 1000); // Pequeno delay para mostrar a tela de loading
}

// FUN√á√ÉO PARA MOSTRAR RESULTADO DO CADASTRO
function mostrarResultadoCadastro(resultado, nome, email, cpf) {
    const artistaId = resultado.artistaId || "ART" + Math.floor(1000 + Math.random() * 9000);
    const dataAtual = new Date().toLocaleString('pt-BR');
    
    const resultadoDiv = document.createElement('div');
    resultadoDiv.id = 'resultadoCadastro';
    resultadoDiv.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.95);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9998;
        padding: 20px;
    `;
    
    resultadoDiv.innerHTML = `
        <div style="background: white; border-radius: 15px; padding: 40px; max-width: 500px; width: 100%; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
            <div style="font-size: 70px; color: ${resultado.success ? '#28a745' : '#dc3545'}; margin-bottom: 20px;">
                ${resultado.success ? '‚úÖ' : '‚ùå'}
            </div>
            
            <h2 style="color: #333; margin-bottom: 10px;">
                ${resultado.success ? 'CADASTRO CONCLU√çDO!' : 'OPS, ALGO DEU ERRADO'}
            </h2>
            
            <p style="color: #666; margin-bottom: 30px;">
                ${resultado.message || (resultado.success ? 'Artista cadastrado com sucesso!' : 'Erro no cadastro')}
            </p>
            
            ${resultado.success ? `
                <div style="background: #e8f4ff; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: left;">
                    <h4 style="color: #0072ff; margin-bottom: 15px;">üìã SEUS DADOS</h4>
                    <p><strong>Nome:</strong> ${nome}</p>
                    <p><strong>Email:</strong> ${email}</p>
                    <p><strong>CPF:</strong> ${cpf}</p>
                    <p><strong>ID do Artista:</strong> <span style="background: #0072ff; color: white; padding: 5px 10px; border-radius: 5px; font-weight: bold;">${artistaId}</span></p>
                    <p><strong>Data:</strong> ${dataAtual}</p>
                </div>
                
                <div style="margin: 30px 0;">
                    <a href="https://docs.google.com/spreadsheets/d/1NOc5RHVoWdfdMDur55C5R25FAsAcqQtk5PHVmFlViV0/edit" 
                       target="_blank" 
                       style="display: block; background: #f0f0f0; padding: 15px; border-radius: 8px; text-decoration: none; color: #333; margin-bottom: 10px;">
                        üìä <strong>Ver Planilha com seus dados</strong>
                    </a>
                </div>
            ` : ''}
            
            <div style="display: flex; gap: 10px; justify-content: center; margin-top: 30px;">
                ${resultado.success ? `
                    <button onclick="window.location.href='login.html?artistaId=${artistaId}'" 
                            style="background: #00c6ff; color: white; border: none; padding: 12px 25px; border-radius: 8px; font-weight: bold; cursor: pointer;">
                        üìù Fazer Login
                    </button>
                ` : ''}
                
                <button onclick="document.body.removeChild(document.getElementById('resultadoCadastro')); ${resultado.success ? 'document.getElementById(\'formCadastro\').reset();' : ''}" 
                        style="background: ${resultado.success ? '#6c757d' : '#0072ff'}; color: white; border: none; padding: 12px 25px; border-radius: 8px; font-weight: bold; cursor: pointer;">
                    ${resultado.success ? 'Novo Cadastro' : 'Tentar Novamente'}
                </button>
            </div>
            
            ${!resultado.success ? `
                <div style="margin-top: 30px; padding: 15px; background: #fff3cd; border-radius: 5px; text-align: left;">
                    <h5 style="color: #856404;">üîÑ Solu√ß√µes poss√≠veis:</h5>
                    <ol style="color: #856404; margin-left: 20px;">
                        <li>Verifique sua conex√£o com a internet</li>
                        <li>Tente novamente em alguns minutos</li>
                        <li>Entre em contato com o suporte</li>
                    </ol>
                </div>
            ` : ''}
        </div>
    `;
    
    document.body.appendChild(resultadoDiv);
}

// M√âTODO ALTERNATIVO SE O PRIMEIRO FALHAR
function usarMetodoAlternativo(nome, cpf, email, telefone) {
    console.log("üîÑ Usando m√©todo alternativo...");
    
    // Remover loading antigo
    const loading = document.getElementById('loadingSeloMIV');
    if (loading) document.body.removeChild(loading);
    
    // Criar iframe e formul√°rio invis√≠vel
    const iframe = document.createElement('iframe');
    iframe.name = 'iframeEnvio';
    iframe.style.display = 'none';
    document.body.appendChild(iframe);
    
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = "https://script.google.com/macros/s/AKfycbw6WpjiLomixA6H3IK-y5-VNoCq3WbstZhYbjHrM8ueJX-LmWsNxFcOxAwi6wCRxXK7/exec";
    form.target = 'iframeEnvio';
    form.style.display = 'none';
    
    // Adicionar campos
    const campos = [
        ['acao', 'cadastrar_artista'],
        ['nome', nome],
        ['cpf', cpf],
        ['email', email]
    ];
    
    if (telefone) campos.push(['telefone', telefone]);
    
    campos.forEach(([name, value]) => {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = name;
        input.value = value;
        form.appendChild(input);
    });
    
    document.body.appendChild(form);
    
    // Mostrar mensagem de envio
    const mensagemEnvio = document.createElement('div');
    mensagemEnvio.style.cssText = `
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.9);
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9997;
    `;
    mensagemEnvio.innerHTML = `
        <div style="text-align: center;">
            <div style="font-size: 50px;">üì§</div>
            <h3>Enviando dados...</h3>
            <p>Usando m√©todo seguro</p>
        </div>
    `;
    document.body.appendChild(mensagemEnvio);
    
    // Enviar formul√°rio
    form.submit();
    
    // Ap√≥s 3 segundos, mostrar sucesso
    setTimeout(() => {
        document.body.removeChild(mensagemEnvio);
        
        const artistaId = "ART" + Math.floor(1000 + Math.random() * 9000);
        
        mostrarResultadoCadastro({
            success: true,
            message: "‚úÖ Dados enviados com m√©todo alternativo!",
            artistaId: artistaId
        }, nome, email, cpf);
        
        // Limpar formul√°rio
        document.getElementById('formCadastro').reset();
        
    }, 3000);
}

// TESTE R√ÅPIDO DA API (para bot√£o de teste)
function testarConexaoAPI() {
    const API_URL = "https://script.google.com/macros/s/AKfycbw6WpjiLomixA6H3IK-y5-VNoCq3WbstZhYbjHrM8ueJX-LmWsNxFcOxAwi6wCRxXK7/exec";
    
    alert("üîç Testando conex√£o com a API...");
    
    fetch(API_URL, {
        method: 'POST',
        headers: {'Content-Type': 'application/x-www-form-urlencoded'},
        body: 'acao=testar_conexao'
    })
    .then(r => r.text())
    .then(texto => {
        alert("‚úÖ API RESPONDEU!\n\n" + texto.substring(0, 200));
    })
    .catch(err => {
        alert("‚ùå ERRO: " + err.message);
    });
}
