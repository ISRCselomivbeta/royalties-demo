<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIV Premium | Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root {
            --miv-blue: #0072ff;
            --miv-cyan: #00c6ff;
            --bg-dark: #05070a;
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
        }

        body {
            background: var(--bg-dark);
            color: #ffffff;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            padding-bottom: 110px;
        }

        /* Barra de Notícias (Ticker) */
        .ticker-wrap {
            background: rgba(0, 114, 255, 0.1);
            padding: 5px 0;
            border-bottom: 1px solid var(--border);
            overflow: hidden;
        }
        .ticker {
            display: inline-block;
            white-space: nowrap;
            animation: ticker 30s linear infinite;
            font-size: 0.75rem;
            color: var(--miv-cyan);
            font-weight: bold;
        }
        @keyframes ticker {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        /* Perfil Social */
        .profile-header {
            padding: 30px 20px;
            background: radial-gradient(circle at top, rgba(0, 198, 255, 0.15), transparent);
        }
        .profile-pic {
            width: 85px; height: 85px;
            border-radius: 50%;
            border: 3px solid var(--miv-cyan);
            padding: 3px;
            background: var(--bg-dark);
            object-fit: cover;
            box-shadow: 0 0 20px rgba(0, 198, 255, 0.3);
        }

        /* Card de Saldo Impressionante */
        .wallet-card {
            background: linear-gradient(135deg, rgba(0, 114, 255, 0.8), rgba(0, 198, 255, 0.4));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            padding: 25px;
            margin: 0 15px 30px;
            box-shadow: 0 15px 35px rgba(0, 114, 255, 0.3);
            transition: 0.3s;
        }
        .saldo-valor {
            font-size: 2.2rem;
            font-weight: 800;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
            letter-spacing: -1px;
        }

        /* Músicas / Assets */
        .music-card {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 18px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
            transition: 0.3s;
        }
        .music-card:hover { border-color: var(--miv-cyan); transform: translateY(-3px); }

        .album-art {
            width: 55px; height: 55px;
            border-radius: 12px;
            background: linear-gradient(45deg, #1e2329, #0b0e11);
            display: flex; align-items: center; justify-content: center;
        }

        /* Player Inferior */
        .miv-player {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(5, 7, 10, 0.9);
            backdrop-filter: blur(25px);
            border-top: 1px solid var(--border);
            padding: 15px 25px;
            z-index: 1000;
            display: none;
        }

        .btn-miv {
            background: var(--miv-cyan);
            color: #000; font-weight: bold; border: none;
            border-radius: 12px; padding: 12px;
            box-shadow: 0 4px 15px rgba(0, 198, 255, 0.3);
        }

        .text-micro { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1px; }
    </style>
</head>
<body>

    <div class="ticker-wrap">
        <div class="ticker">
            • @Miv_Artist lançou novo Token M002 • Play em "Som da Rua" rendendo R$ 0,0000001 • 1.254 usuários minerando agora • Bitcoin Musical em alta +4.2% •
        </div>
    </div>

    <div class="profile-header text-center">
        <div class="d-flex justify-content-between px-3">
            <button class="btn text-white" onclick="alterarFoto()"><i class="bi bi-camera"></i></button>
            <button onclick="logout()" class="btn text-danger"><i class="bi bi-power"></i></button>
        </div>
        <img id="userFoto" src="https://cdn-icons-png.flaticon.com/512/149/149071.png" class="profile-pic mb-2">
        <h5 class="fw-bold mb-0" id="nomeUser">...</h5>
        <p class="text-micro text-info">Investidor Verificado MIV</p>
    </div>

    <div class="wallet-card text-center">
        <p class="text-micro mb-1 opacity-75">Meu Patrimônio Musical</p>
        <div class="saldo-valor" id="saldoTxt">R$ 0,00000000</div>
        <div class="mt-2">
            <span class="badge rounded-pill bg-success bg-opacity-25 text-success p-2 px-3" style="font-size: 0.7rem;">
                <i class="bi bi-graph-up"></i> +0.0000008 hoje
            </span>
        </div>
    </div>

    <div class="container px-4">
        <h6 class="text-micro mb-3 opacity-50">Marketplace de Ativos</h6>
        
        <div class="music-card">
            <div class="d-flex align-items-center mb-3">
                <div class="album-art me-3 shadow">
                    <i class="bi bi-vinyl-fill text-info h3 mb-0"></i>
                </div>
                <div class="flex-grow-1">
                    <h6 class="mb-0 fw-bold">Som da Rua</h6>
                    <span class="text-muted small">Cota: R$ 15,00 | <span class="text-success">+2.1%</span></span>
                </div>
                <button class="btn btn-sm btn-outline-info rounded-pill" onclick="abrirInvest()">Investir</button>
            </div>
            <button class="btn btn-miv w-100" onclick="playMusic('M001', 'Som da Rua')">
                <i class="bi bi-play-fill"></i> OUVIR E MINERAR
            </button>
        </div>

        <div class="music-card py-3">
            <h6 class="text-micro mb-2"><i class="bi bi-people-fill"></i> Atividade da Rede</h6>
            <div id="socialFeed" style="font-size: 0.8rem;">
                <div class="d-flex gap-2 mb-2">
                    <div class="text-info fw-bold">Alex S.</div> <span>comprou 10 cotas de M001</span>
                </div>
                <div class="d-flex gap-2">
                    <div class="text-info fw-bold">Marina</div> <span>minerou R$ 0,0000001 agora</span>
                </div>
            </div>
        </div>
    </div>

    <div class="miv-player" id="playerArea">
        <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
                <div class="spinner-grow text-info me-3" style="width: 1.2rem; height: 1.2rem;"></div>
                <div>
                    <small class="text-micro d-block" id="playingTitle">MINERANDO...</small>
                    <span class="fw-bold text-info" id="timerStatus">Validando: 30s</span>
                </div>
            </div>
            <button class="btn text-white p-0" onclick="cancelarPlay()"><i class="bi bi-x-circle h4"></i></button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbz-XDvFYhUjmZMfnZreUdzULCfAprqStkfNAWaY2vXqR4XwOgtF0OOe30g4z7-v_-xu/exec";
        let timerInterval;

        window.onload = () => {
            const nome = localStorage.getItem('userName');
            if(!nome) { window.location.href = 'login.html'; return; }
            document.getElementById('nomeUser').innerText = nome;
            
            const foto = localStorage.getItem('userFoto');
            if(foto) document.getElementById('userFoto').src = foto;
            
            carregarSaldo();
        };

        async function carregarSaldo() {
            try {
                const res = await fetch(`${API_URL}?acao=ver_carteira&userId=${localStorage.getItem('userId')}`);
                const data = await res.json();
                if(data.success) {
                    // Animação simples de atualização
                    document.getElementById('saldoTxt').innerText = "R$ " + data.saldo.toFixed(8);
                }
            } catch(e) { console.log("Erro carregar saldo"); }
        }

        function playMusic(id, titulo) {
            document.getElementById('playerArea').style.display = 'block';
            document.getElementById('playingTitle').innerText = "MINERANDO: " + titulo;
            let tempo = 30;
            
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                tempo--;
                document.getElementById('timerStatus').innerText = "Validando: " + tempo + "s";
                if(tempo <= 0) {
                    clearInterval(timerInterval);
                    creditar(id);
                }
            }, 1000);
        }

        async function creditar(id) {
            document.getElementById('timerStatus').innerText = "Depositando...";
            await fetch(`${API_URL}?acao=registrar_play&ouvinte_id=${localStorage.getItem('userId')}&musica_id=${id}`);
            document.getElementById('playerArea').style.display = 'none';
            alert("Mineração concluída! +R$ 0,0000001");
            carregarSaldo();
        }

        function alterarFoto() {
            const url = prompt("Link (URL) da sua foto:");
            if(url) {
                localStorage.setItem('userFoto', url);
                document.getElementById('userFoto').src = url;
            }
        }

        function abrirInvest() {
            const q = prompt("Quantas ações de M001 deseja comprar (R$ 15,00 cada)?");
            if(q) {
                const v = q * 15;
                fetch(`${API_URL}?acao=negociar_acao&user_id=${localStorage.getItem('userId')}&musica_id=M001&quantidade=${q}&preco_unitario=15&valor=${v}&tipo_ordem=COMPRA`)
                .then(() => { alert("Sucesso! Verifique sua carteira."); location.reload(); });
            }
        }

        function logout() { localStorage.clear(); location.href='login.html'; }
        function cancelarPlay() { clearInterval(timerInterval); document.getElementById('playerArea').style.display = 'none'; }
    </script>
</body>
</html>
