<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ouvinte | SELO MIV</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body{
    background:#121212;
    color:#fff;
}
.card-dark{
    background:#181818;
    border-radius:12px;
}
.btn-miv{
    background:linear-gradient(135deg,#00c6ff,#0072ff);
    border:none;
    color:#fff;
}
.play{
    font-size:22px;
}
</style>
</head>

<body>

<!-- ðŸ” PROTEÃ‡ÃƒO DE ROTA -->
<script>
if(localStorage.getItem("userType") !== "ouvinte"){
    alert("Acesso restrito para ouvintes.");
    window.location.href = "login.html";
}
</script>

<nav class="navbar navbar-dark bg-dark px-3">
    <span class="navbar-brand fw-bold">
        SELO <span style="color:#00c6ff">MIV</span>
        <small class="d-block" style="font-size:10px">OUVINTE</small>
    </span>
    <button class="btn btn-outline-light btn-sm" onclick="logout()">Sair</button>
</nav>

<div class="container mt-4">

<!-- SALDO -->
<div class="card card-dark p-4 mb-4 text-center">
    <h5>ðŸ’° Seu saldo ouvindo mÃºsica</h5>
    <h2 id="saldo">R$ 0,00</h2>
    <small class="text-muted">VocÃª ganha enquanto escuta</small>
</div>

<!-- MÃšSICAS -->
<div class="card card-dark p-4">
    <h5>ðŸŽµ MÃºsicas disponÃ­veis</h5>
    <div id="listaMusicas"></div>
</div>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbztk1ciaAYousnQgD3oTAtgVtiilhbiG25WcmP85QZatociltDhbc_wOnkeFrTwKoY/exec";

let saldo = Number(localStorage.getItem("saldo")) || 0;
document.getElementById("saldo").innerText = saldo.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});

/* ======================
   LOGOUT
====================== */
function logout(){
    localStorage.clear();
    window.location.href = "index.html";
}

/* ======================
   MÃšSICAS (EXEMPLO)
====================== */
const musicas = [
    {id:1, nome:"Som da Rua", artista:"Elzo"},
    {id:2, nome:"Noite Urbana", artista:"MIV Records"},
    {id:3, nome:"CoraÃ§Ã£o Livre", artista:"Artista X"}
];

function renderMusicas(){
    const div = document.getElementById("listaMusicas");
    div.innerHTML="";
    musicas.forEach(m=>{
        div.innerHTML += `
        <div class="d-flex justify-content-between align-items-center border-bottom py-3">
            <div>
                <strong>${m.nome}</strong><br>
                <small class="text-muted">${m.artista}</small>
            </div>
            <button class="btn btn-miv play" onclick="ouvir(${m.id})">â–¶</button>
        </div>`;
    });
}

/* ======================
   OUVIR = INVESTIR
====================== */
function ouvir(idMusica){
    // valor simbÃ³lico por play
    saldo += 0.05;

    localStorage.setItem("saldo", saldo);
    document.getElementById("saldo").innerText =
        saldo.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});

    // Envia play para API
    fetch(API_URL,{
        method:"POST",
        headers:{"Content-Type":"application/x-www-form-urlencoded"},
        body:`action=play&musica=${idMusica}&ouvinte=${localStorage.getItem("userId")}`
    });

    alert("ðŸŽ§ VocÃª ouviu e ganhou dinheiro!");
}

renderMusicas();
</script>

</body>
</html>
